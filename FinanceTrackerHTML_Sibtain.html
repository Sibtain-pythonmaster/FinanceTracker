<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Finance Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 to-blue-200 text-gray-900">
  <div class="max-w-6xl mx-auto p-6 space-y-6">
    <h1 class="text-4xl font-bold text-center mb-4">💰 Finance Tracker v3.0 — “The Complete Edition” By Sibtain</h1>
<p class="text-center text-lg text-gray-700 max-w-2xl mx-auto">
  Track your deposits, expenses, recurring bills, and savings goals, all of this will be in one place. 
  Stay organized, visualize your spending with charts, and manage your money smarter. 💼 Keep checking regurarly UPDATES EVERY MONDAY, (OR MOSTLY EVERY MONDAY😉) Also be sure to buy me a coffee sometime!😃
</p>


    <!-- Balance Card -->
    <div id="balanceCard" class="p-6 bg-white rounded-2xl shadow-md text-center transition">
      <h2 class="text-xl font-semibold">🏦 Balance</h2>
      <p id="balance" class="text-3xl font-bold mt-2">$0.00</p>
    </div>

    <!-- Quick Add Buttons -->
    <div class="p-4 bg-white rounded-2xl shadow-md text-center space-x-2">
      <h2 class="font-semibold text-lg mb-2">⚡ Quick Add Expense</h2>
      <button onclick="quickAdd('Coffee', 5)" class="bg-orange-400 text-white px-3 py-1 rounded hover:bg-orange-500">☕ Coffee - $5</button>
      <button onclick="quickAdd('Lunch', 12)" class="bg-orange-400 text-white px-3 py-1 rounded hover:bg-orange-500">🍔 Lunch - $12</button>
      <button onclick="quickAdd('Transport', 10)" class="bg-orange-400 text-white px-3 py-1 rounded hover:bg-orange-500">🚌 Transport - $10</button>
    </div>

    <!-- Progress Bar -->
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="text-lg font-semibold mb-2">📊 Spending vs Savings</h2>
      <div class="w-full bg-gray-200 rounded-full h-4">
        <div id="progressBar" class="h-4 rounded-full transition-all duration-500" style="width: 100%"></div>
      </div>
    </div>

    <!-- Forms -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="p-4 bg-white rounded-2xl shadow-md">
        <h2 class="font-semibold text-lg mb-2">➕ Add Deposit</h2>
        <form id="depositForm" class="space-y-2">
          <input type="number" step="0.01" min="0" placeholder="Amount" class="w-full border rounded-lg p-2" required>
          <button class="w-full bg-green-500 text-white rounded-lg p-2 hover:bg-green-600">Add Deposit</button>
        </form>
      </div>
      <div class="p-4 bg-white rounded-2xl shadow-md">
        <h2 class="font-semibold text-lg mb-2">💸 Add Expense</h2>
        <form id="expenseForm" class="space-y-2">
          <input type="text" placeholder="Category (e.g., Food, Bills)" class="w-full border rounded-lg p-2" required>
          <input type="number" step="0.01" min="0" placeholder="Amount" class="w-full border rounded-lg p-2" required>
          <!-- Recurring checkbox -->
          <label class="flex items-center space-x-2">
            <input type="checkbox" id="recurringExpense" class="h-4 w-4">
            <span>Make this a recurring monthly expense</span>
          </label>
          <button class="w-full bg-red-500 text-white rounded-lg p-2 hover:bg-red-600">Add Expense</button>
        </form>
      </div>
    </div>

    <!-- Sort and Filter Controls -->
    <div class="p-4 bg-white rounded-2xl shadow-md flex flex-wrap gap-3 justify-center">
      <select id="sortSelect" class="border rounded-lg p-2">
        <option value="newest">Sort by: Newest</option>
        <option value="oldest">Oldest</option>
        <option value="amount">Amount</option>
      </select>
      <input id="filterCategory" type="text" placeholder="Filter by category..." class="border rounded-lg p-2">
      <button onclick="updateUI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Apply</button>
    </div>

    <!-- Lists -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="p-4 bg-white rounded-2xl shadow-md">
        <h2 class="font-semibold text-lg mb-2">📈 Deposits</h2>
        <ul id="depositList" class="space-y-1 text-green-600"></ul>
      </div>
      <div class="p-4 bg-white rounded-2xl shadow-md">
        <h2 class="font-semibold text-lg mb-2">💸 Expenses</h2>
        <ul id="expenseList" class="space-y-1 text-red-600"></ul>
      </div>
    </div>

    <!-- Recurring Expenses -->
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="font-semibold text-lg mb-2">🔁 Recurring Monthly Expenses</h2>
      <ul id="recurringList" class="space-y-1 text-purple-600"></ul>
    </div>

    <!-- Totals by Category -->
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="font-semibold text-lg mb-2">🧮 Totals by Category</h2>
      <ul id="categoryTotals" class="space-y-1"></ul>
    </div>

    <!-- Charts -->
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="font-semibold text-lg mb-2">📊 Expenses by Category</h2>
      <canvas id="expenseChart" height="150"></canvas>
    </div>
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="font-semibold text-lg mb-2">📅 Monthly Spending Trend</h2>
      <canvas id="monthlyChart" height="150"></canvas>
    </div>

    <!-- Goal Section -->
    <div class="p-4 bg-white rounded-2xl shadow-md">
      <h2 class="font-semibold text-lg mb-2">🎯 Savings Goal</h2>
      <form id="goalForm" class="space-y-2 mb-4">
        <input type="text" placeholder="Goal Name (e.g., Laptop)" class="w-full border rounded-lg p-2" required>
        <input type="number" step="0.01" min="1" placeholder="Goal Amount" class="w-full border rounded-lg p-2" required>
        <button class="w-full bg-blue-500 text-white rounded-lg p-2 hover:bg-blue-600">Set Goal</button>
      </form>

      <div id="goalArea" class="hidden">
        <p class="font-semibold">Goal: <span id="goalName"></span> - $<span id="goalAmount"></span></p>
        <div class="w-full bg-gray-200 rounded-full h-4 mt-2">
          <div id="goalProgress" class="bg-blue-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        <p class="text-sm mt-1">Progress: <span id="goalPercent">0</span>%</p>
        <p id="goalStatus" class="text-green-600 font-semibold mt-2 hidden">🎉 Goal Reached!</p>
      </div>
    </div>

    <!-- Controls -->
    <div class="text-center space-x-4">
      <button id="resetBtn" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">♻️ Reset All Data</button>
      <button id="exportBtn" class="bg-blue-400 text-white px-4 py-2 rounded-lg hover:bg-blue-500">📤 Export</button>
      <input type="file" id="importFile" class="hidden" accept="application/json">
      <label for="importFile" class="bg-blue-500 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-blue-600">📥 Import</label>
      <a href="https://buymeacoffee.com/sibtainsalw" target="_blank" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600">☕ Buy me Coffee!</a>
    </div>
  </div>

  <script>
    // ===== STATE (with safe upgrade for older saves) =====
    let state = JSON.parse(localStorage.getItem("financeData")) || {
      balance: 0,
      deposits: [],
      expenses: [],
      goal: { name: "", amount: 0 }
    };
    // upgrade old saves safely
    if (!state.recurring) state.recurring = [];
    if (!state.lastAppliedMonth) state.lastAppliedMonth = null;

    // ===== ELEMENTS =====
    const balanceEl = document.getElementById("balance");
    const balanceCard = document.getElementById("balanceCard");
    const progressBar = document.getElementById("progressBar");
    const depositList = document.getElementById("depositList");
    const expenseList = document.getElementById("expenseList");
    const recurringList = document.getElementById("recurringList");
    const expenseChartCtx = document.getElementById("expenseChart").getContext("2d");
    const monthlyChartCtx = document.getElementById("monthlyChart").getContext("2d");
    const categoryTotals = document.getElementById("categoryTotals");

    const goalForm = document.getElementById("goalForm");
    const goalArea = document.getElementById("goalArea");
    const goalNameEl = document.getElementById("goalName");
    const goalAmountEl = document.getElementById("goalAmount");
    const goalProgress = document.getElementById("goalProgress");
    const goalPercentEl = document.getElementById("goalPercent");
    const goalStatus = document.getElementById("goalStatus");

    // ===== CHARTS =====
    const expenseChart = new Chart(expenseChartCtx, {
      type: 'pie',
      data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    const monthlyChart = new Chart(monthlyChartCtx, {
      type: 'bar',
      data: { labels: [], datasets: [
        { label: 'Expenses', data: [], backgroundColor: 'rgba(255,99,132,0.6)' },
        { label: 'Deposits', data: [], backgroundColor: 'rgba(75,192,192,0.6)' }
      ]},
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // ===== HELPERS =====
    function save() {
      localStorage.setItem("financeData", JSON.stringify(state));
    }
    // Normalize any stored date to YYYY-MM key (works with ISO or locale)
    function monthKey(dstr) {
      // If already ISO YYYY-MM-DD
      if (/^\d{4}-\d{2}-\d{2}$/.test(dstr)) return dstr.slice(0,7);
      // Try to parse locale dates safely
      const d = new Date(dstr);
      if (!isNaN(d)) return d.toISOString().slice(0,7);
      // Fallback to current month if parsing fails
      const now = new Date();
      return now.toISOString().slice(0,7);
    }
    function todayISO() {
      return new Date().toISOString().slice(0,10);
    }

    // ===== RECURRING =====
    function applyRecurringExpenses() {
      const currentMonth = new Date().toISOString().slice(0,7);
      if (state.lastAppliedMonth === currentMonth) return; // prevent duplicates
      state.recurring.forEach(r => {
        state.balance -= r.amount;
        state.expenses.push({ category: r.category + " (recurring)", amount: r.amount, date: todayISO() });
      });
      state.lastAppliedMonth = currentMonth;
      save();
    }

    function updateRecurringList() {
      recurringList.innerHTML = state.recurring.length
        ? state.recurring.map((r, i) =>
            `<li>🔁 ${r.category}: -$${r.amount.toFixed(2)} / month 
              <button onclick="deleteRecurring(${i})" class="text-xs text-red-500 ml-2">❌</button>
            </li>`
          ).join("")
        : "<li>No recurring expenses yet.</li>";
    }

    function deleteRecurring(i){
      state.recurring.splice(i,1);
      save();
      updateRecurringList();
      updateUI();
    }

    // ===== UI =====
    function updateUI() {
      // Sorting & filtering for expenses
      const sortType = document.getElementById("sortSelect").value;
      const filterText = document.getElementById("filterCategory").value.toLowerCase();

      let filtered = [...state.expenses];
      if (filterText) filtered = filtered.filter(e => (e.category || "").toLowerCase().includes(filterText));

      if (sortType === "amount") filtered.sort((a,b) => b.amount - a.amount);
      else if (sortType === "oldest") filtered.sort((a,b) => new Date(a.date) - new Date(b.date));
      else filtered.sort((a,b) => new Date(b.date) - new Date(a.date)); // newest

      // Balance + color
      balanceEl.textContent = `$${state.balance.toFixed(2)}`;
      balanceCard.classList.remove("bg-green-100","bg-yellow-100","bg-red-100");
      if (state.balance > 100) balanceCard.classList.add("bg-green-100");
      else if (state.balance >= 0) balanceCard.classList.add("bg-yellow-100");
      else balanceCard.classList.add("bg-red-100");

      // Deposits list
      depositList.innerHTML = "";
      state.deposits.forEach((d, i) => {
        const li = document.createElement("li");
        li.innerHTML = `💰 +$${d.amount.toFixed(2)} (${d.date})
          <button onclick="editDeposit(${i})" class='text-xs text-blue-500 ml-2'>✏️</button>
          <button onclick="deleteDeposit(${i})" class='text-xs text-red-500 ml-1'>❌</button>`;
        depositList.appendChild(li);
      });

      // Expenses list
      expenseList.innerHTML = "";
      filtered.forEach((e, i) => {
        const li = document.createElement("li");
        li.className = "animate-fadeIn";
        li.innerHTML = `💸 ${e.category}: -$${e.amount.toFixed(2)} (${e.date})
          <button onclick="editExpense(${i})" class='text-xs text-blue-500 ml-2'>✏️</button>
          <button onclick="deleteExpense(${i})" class='text-xs text-red-500 ml-1'>❌</button>`;
        expenseList.appendChild(li);
      });

      // Category totals
      const catTotals = {};
      state.expenses.forEach(e => { catTotals[e.category] = (catTotals[e.category] || 0) + e.amount; });
      categoryTotals.innerHTML = Object.entries(catTotals)
        .map(([cat, amt]) => `<li>${cat}: $${amt.toFixed(2)}</li>`).join("") || "<li>No data yet.</li>";

      // Pie chart
      expenseChart.data.labels = Object.keys(catTotals);
      expenseChart.data.datasets[0].data = Object.values(catTotals);
      expenseChart.data.datasets[0].backgroundColor = Object.keys(catTotals).map((_, i) => `hsl(${i * 50},70%,60%)`);
      expenseChart.update();

      // Monthly bar chart (supports ISO or locale dates)
      const months = {}; // { 'YYYY-MM': {exp, dep} }
      state.expenses.forEach(e => {
        const m = monthKey(e.date);
        if (!months[m]) months[m] = {exp:0, dep:0};
        months[m].exp += e.amount;
      });
      state.deposits.forEach(d => {
        const m = monthKey(d.date);
        if (!months[m]) months[m] = {exp:0, dep:0};
        months[m].dep += d.amount;
      });
      const labels = Object.keys(months).sort();
      monthlyChart.data.labels = labels;
      monthlyChart.data.datasets[0].data = labels.map(m => months[m].exp);
      monthlyChart.data.datasets[1].data = labels.map(m => months[m].dep);
      monthlyChart.update();

      // Progress bar
      const totalDeposits = state.deposits.reduce((a, b) => a + b.amount, 0);
      const totalExpenses = state.expenses.reduce((a, b) => a + b.amount, 0);
      const percent = totalDeposits > 0 ? Math.max(0, ((totalDeposits - totalExpenses) / totalDeposits) * 100) : 100;
      progressBar.style.width = percent + "%";
      progressBar.className = "h-4 rounded-full transition-all duration-500 " + (percent > 50 ? "bg-green-500" : percent > 20 ? "bg-yellow-500" : "bg-red-500");

      updateGoalUI();
      save();
    }

    function updateGoalUI() {
      if (state.goal.amount > 0) {
        goalArea.classList.remove("hidden");
        goalNameEl.textContent = state.goal.name;
        goalAmountEl.textContent = state.goal.amount.toFixed(2);
        const percent = Math.min(100, (state.balance / state.goal.amount) * 100);
        goalProgress.style.width = percent + "%";
        goalPercentEl.textContent = percent.toFixed(1);
        goalStatus.classList.toggle("hidden", state.balance < state.goal.amount);
      } else {
        goalArea.classList.add("hidden");
      }
    }

    // --- CRUD + Quick Add Functions ---
    function deleteDeposit(i){ state.balance -= state.deposits[i].amount; state.deposits.splice(i,1); updateUI(); }
    function deleteExpense(i){ state.balance += state.expenses[i].amount; state.expenses.splice(i,1); updateUI(); }
    function editDeposit(i){ const v = prompt("Edit deposit amount:", state.deposits[i].amount); if (v !== null && !isNaN(parseFloat(v))) { state.balance += parseFloat(v) - state.deposits[i].amount; state.deposits[i].amount = parseFloat(v); updateUI(); } }
    function editExpense(i){ const v = prompt("Edit expense amount:", state.expenses[i].amount); if (v !== null && !isNaN(parseFloat(v))) { state.balance += state.expenses[i].amount - parseFloat(v); state.expenses[i].amount = parseFloat(v); updateUI(); } }
    function quickAdd(category, amount){ state.balance -= amount; state.expenses.push({ category, amount, date: todayISO() }); updateUI(); }

    // --- Forms ---
    document.getElementById("depositForm").addEventListener("submit", e => {
      e.preventDefault();
      const amount = parseFloat(e.target[0].value);
      if (amount > 0) {
        state.balance += amount;
        state.deposits.push({ amount, date: todayISO() });
        updateUI();
      }
      e.target.reset();
    });

    document.getElementById("expenseForm").addEventListener("submit", e => {
      e.preventDefault();
      const category = e.target[0].value.trim();
      const amount = parseFloat(e.target[1].value);
      const isRecurring = document.getElementById("recurringExpense").checked;
      if (category && amount > 0) {
        state.balance -= amount;
        state.expenses.push({ category, amount, date: todayISO() });
        if (isRecurring) {
          state.recurring.push({ category, amount });
          alert(`🔁 ${category} added as a recurring monthly expense.`);
        }
        updateUI();
        updateRecurringList();
      }
      e.target.reset();
    });

    goalForm.addEventListener("submit", e => {
      e.preventDefault();
      const name = e.target[0].value.trim();
      const amount = parseFloat(e.target[1].value);
      if (name && amount > 0) { state.goal = { name, amount }; updateUI(); }
      e.target.reset();
    });

    // --- Reset / Export / Import ---
    document.getElementById("resetBtn").addEventListener("click", () => {
      if (confirm("Are you sure you want to reset all data?")) {
        state = { balance: 0, deposits: [], expenses: [], recurring: [], goal: { name: "", amount: 0 }, lastAppliedMonth: null };
        updateUI();
        updateRecurringList();
      }
    });

    document.getElementById("exportBtn").onclick = () => {
      const blob = new Blob([JSON.stringify(state)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "financeData.json"; a.click();
    };

    document.getElementById("importFile").addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => { state = JSON.parse(evt.target.result); if (!state.recurring) state.recurring=[]; if (!state.lastAppliedMonth) state.lastAppliedMonth=null; updateUI(); updateRecurringList(); };
      reader.readAsText(file);
    });

    // --- Animations ---
    document.head.insertAdjacentHTML("beforeend", `<style>
      .animate-fadeIn { animation: fadeIn 0.4s ease-in; }
      @keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:translateY(0);} }
    </style>`);

    // Init
    applyRecurringExpenses();
    updateRecurringList();
    updateUI();
  </script>
</body>
</html>
